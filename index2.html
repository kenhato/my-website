<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Music 中継ページ</title>

    <!-- Twitterカード用のOGPタグを動的に設定 -->
    <script>
        function setOGPTags() {
            const params = new URLSearchParams(window.location.search);
            const musicUrl = params.get("musicUrl");

            // デバッグ用ログ
            console.log("受け取ったURL:", musicUrl);

            // URLが不正な場合のエラー処理
            if (!musicUrl || !musicUrl.includes("music.apple.com")) {
                document.body.innerHTML = "<h1>無効なURLです</h1>";
                return;
            }

            const head = document.head;

            // OGPタグを動的に追加
            const ogTitle = document.createElement("meta");
            ogTitle.setAttribute("property", "og:title");
            ogTitle.setAttribute("content", "Apple Musicでおすすめの曲をチェック！");
            head.appendChild(ogTitle);

            const ogDescription = document.createElement("meta");
            ogDescription.setAttribute("property", "og:description");
            ogDescription.setAttribute("content", "今すぐこの曲を聴いてみよう！ 🎶");
            head.appendChild(ogDescription);

            const ogImage = document.createElement("meta");
            ogImage.setAttribute("property", "og:image");
            ogImage.setAttribute("content", "https://is5-ssl.mzstatic.com/image/thumb/Music2/v4/8f/b9/94/8fb9940b-f1b4-b61e-0214-e1699c74be7e/00602547275595.rgb.jpg");
            head.appendChild(ogImage);

            const ogUrl = document.createElement("meta");
            ogUrl.setAttribute("property", "og:url");
            ogUrl.setAttribute("content", musicUrl);
            head.appendChild(ogUrl);
        }

        document.addEventListener("DOMContentLoaded", setOGPTags);

        function tweetThisPage() {
            const currentUrl = window.location.href;
            const tweetContent = `この曲をチェックしてね！ 🎵\n${currentUrl}`;
            const tweetUrlWeb = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetContent)}`;

            // ツイート画面を開く
            window.open(tweetUrlWeb, '_blank');
        }
    </script>
</head>
<body>
    <h1>Apple Musicでこの曲を聴こう！</h1>
    <p>以下のリンクをクリックしてApple Musicで再生できます。</p>
    <a id="musicLink" href="#" target="_blank" style="color: blue; text-decoration: underline;">Apple Musicで再生</a>
    <br><br>
    <!-- ツイートするボタン -->
    <button onclick="tweetThisPage()" style="padding: 10px 20px; font-size: 16px; background-color: #1DA1F2; color: white; border: none; border-radius: 5px; cursor: pointer;">
        ツイートする
    </button>

    <script>
        const params = new URLSearchParams(window.location.search);
        const musicUrl = params.get("musicUrl");
        const musicLink = document.getElementById("musicLink");

        if (musicUrl) {
            musicLink.href = musicUrl;
        } else {
            console.error("URLパラメータが取得できませんでした。");
        }
    </script>
</body>
</html>
